version: "3"

vars:
  VERSION: "0.1.1"

tasks:
  pre-commit:
    desc: Run pre-commit checks
    cmds:
      - pre-commit autoupdate
      - pre-commit run --all-files

  gomod-update:
    desc: Update go modules
    cmds:
      - echo "Updating go modules"
      - go get -u ./... && go mod tidy
      - echo "Go modules updated"

  gofmt:
    desc: Format Go code
    cmds:
      - echo "Formatting Go code"
      - gofumpt -l -w .
      - echo "Go code formatted"

  govet:
    desc: Run Go vet
    cmds:
      - echo "Running Go vet"
      - go vet -v ./...
      - echo "Go vet done"

  golangci-lint:
    desc: Run golangci-lint
    cmds:
      - echo "Running golangci-lint"
      - golangci-lint run --timeout=10m
      - echo "Golangci-lint done"

  lint-fmt:
    desc: Run all lint and formatting tasks
    cmds:
      - task: pre-commit
      - task: gomod-update
      - task: gofmt
      - task: govet
      - task: golangci-lint

  git-tag-push:
    desc: Tag and push to Git
    cmds:
      - echo "Tagging version v{{.VERSION}}"
      - git tag -a v{{.VERSION}} -m "Release v{{.VERSION}}"
      - git push origin v{{.VERSION}}
      - echo "Tag and push done"
